<script lang="ts">
	import { onMount } from "svelte";
	import PoweredByLamden from "./powered-by-lamden.svelte";
	export let width = "190px";

	onMount(() => {
		const canvas: any = window.document.getElementById("canvas");
		const c = canvas.getContext("2d");

		let w;
		let h;

		const setCanvasExtents = () => {
			w = document.body.clientWidth;
			h = document.body.clientHeight;
			canvas.width = w;
			canvas.height = h;
		};

		setCanvasExtents();

		window.onresize = () => {
			setCanvasExtents();
		};

		const makeStars = (count) => {
			const out = [];
			for (let i = 0; i < count; i++) {
				const s = {
					x: Math.random() * 1600 - 800,
					y: Math.random() * 900 - 450,
					z: Math.random() * 1000
				};
				out.push(s);
			}
			return out;
		};

		let stars = makeStars(10000);

		const clear = () => {
			c.fillStyle = "black";
			c.fillRect(0, 0, canvas.width, canvas.height);
		};

		const putPixel = (x, y, brightness) => {
			const intensity = brightness * 255;
			const rgb =
				"rgb(" + intensity + "," + intensity + "," + intensity + ")";
			c.fillStyle = rgb;
			c.fillRect(x, y, 1, 1);
		};

		const moveStars = (distance) => {
			const count = stars.length;
			for (var i = 0; i < count; i++) {
				const s = stars[i];
				s.z -= distance;
				while (s.z <= 1) {
					s.z += 1000;
				}
			}
		};

		let prevTime;
		const init = (time) => {
			prevTime = time;
			requestAnimationFrame(tick);
		};

		const tick = (time) => {
			let elapsed = time - prevTime;
			prevTime = time;

			moveStars(elapsed * 0.1);

			clear();

			const cx = w / 2;
			const cy = h / 2;

			const count = stars.length;
			for (var i = 0; i < count; i++) {
				const star = stars[i];

				const x = cx + star.x / (star.z * 0.001);
				const y = cy + star.y / (star.z * 0.001);

				if (x < 0 || x >= w || y < 0 || y >= h) {
					continue;
				}

				const d = star.z / 1000.0;
				const b = 1 - d * d;

				putPixel(x, y, b);
			}

			requestAnimationFrame(tick);
		};

		requestAnimationFrame(init);
	});
</script>

<main>
	<div
		style="position: absolute; top:0%; left: 0%; text-align: center; height: 100%; width: 100%; display: flex; justify-content: center; align-items: center; flex-direction: column"
	>
		<img
			src="RS_Logo.png"
			height="100"
			width="100"
			style="margin-bottom: 20px;"
			alt=""
		/>
		<svg
			xmlns="http://www.w3.org/2000/svg"
			{width}
			viewBox="0 0 188.821 25.389"
		>
			<path
				d="M1.86,0V-13.888H4.4l1.178.62a7.988,7.988,0,0,1,1.736-.682A9.345,9.345,0,0,1,9.672-14.2a11.3,11.3,0,0,1,3.674.5,16.253,16.253,0,0,1,1.875.744l-1.085,2.7a11.222,11.222,0,0,0-1.224-.481,17.532,17.532,0,0,0-2-.542A11.889,11.889,0,0,0,8.4-11.532H8.06a2.388,2.388,0,0,0-1.937.589A3.407,3.407,0,0,0,5.642-8.99V0ZM21.173,0a4.759,4.759,0,0,1-3.084-.837,3.356,3.356,0,0,1-1.008-2.728V-9.92a10.044,10.044,0,0,1,.078-1.132,3.6,3.6,0,0,1,.434-1.317A2.727,2.727,0,0,1,18.8-13.454a5.308,5.308,0,0,1,2.372-.434h8.556a5.291,5.291,0,0,1,2.387.434,2.738,2.738,0,0,1,1.194,1.085,3.6,3.6,0,0,1,.434,1.317,10.045,10.045,0,0,1,.077,1.132v5.952a11.066,11.066,0,0,1-.077,1.24,3.214,3.214,0,0,1-.45,1.3A2.738,2.738,0,0,1,32.085-.4a5.554,5.554,0,0,1-2.356.4Zm1.178-2.666h6.2q1.519,0,1.519-1.24V-9.982q0-1.24-1.519-1.24h-6.2q-1.488,0-1.488,1.24v6.076Q20.863-2.666,22.351-2.666ZM41.013,0a5.646,5.646,0,0,1-2.387-.4,2.635,2.635,0,0,1-1.194-1.023A3.348,3.348,0,0,1,37-2.728a11.066,11.066,0,0,1-.077-1.24V-9.92A10.045,10.045,0,0,1,37-11.052a3.6,3.6,0,0,1,.434-1.317,2.727,2.727,0,0,1,1.209-1.085,5.308,5.308,0,0,1,2.371-.434h4.309a51.28,51.28,0,0,1,5.5.2q1.627.2,1.627.419l-.62,2.356q-.868-.062-2.2-.14t-2.868-.124q-1.534-.047-2.991-.047H42.191q-1.488,0-1.488,1.24v6.076q-.031,1.24,1.488,1.24h1.581q1.674,0,3.271-.046t2.93-.124q1.333-.077,2.139-.14l1.24,2.015q0,.961-6.107.961ZM70.37.31A6.949,6.949,0,0,1,68.154,0a5.268,5.268,0,0,1-1.937-1.333l-.5-.5q-.4-.4-.883-.9t-.884-.9l-.527-.527a8.449,8.449,0,0,0-1.472-1.209A3.2,3.2,0,0,0,60.233-5.8a1.464,1.464,0,0,0-.806.124,1.555,1.555,0,0,0-.124.837V0H55.521V-19.623H59.3v11.16h.992a1.365,1.365,0,0,0,.992-.434q.279-.279,1.054-1.116L64.092-11.9q.977-1.054,1.783-1.953h4.557l-.5.961q-.713.744-1.55,1.566T66.758-9.75q-.791.76-1.441,1.333a6.319,6.319,0,0,1-.992.76A9.314,9.314,0,0,1,66-6.526q.744.636,1.612,1.426t2.077,1.782A4.386,4.386,0,0,0,71.7-2.309q.93.139,1.116.139L72.261,0q-.31.093-.837.2A5.214,5.214,0,0,1,70.37.31ZM78.461,0a5.646,5.646,0,0,1-2.387-.4,2.635,2.635,0,0,1-1.193-1.023,3.348,3.348,0,0,1-.434-1.3,11.066,11.066,0,0,1-.077-1.24V-9.92a10.045,10.045,0,0,1,.077-1.132,3.6,3.6,0,0,1,.434-1.317,2.727,2.727,0,0,1,1.209-1.085,5.308,5.308,0,0,1,2.371-.434h6.665a10.532,10.532,0,0,1,3.209.388,2.777,2.777,0,0,1,1.643,1.255,4.805,4.805,0,0,1,.48,2.325v4.588H85.033q-2.79,0-4.541-.124t-2.34-.155v1.7q-.031,1.24,1.488,1.24H81.22q1.674,0,3.271-.046t2.929-.124q1.333-.077,2.139-.14L90.8-.961Q90.8,0,84.692,0Zm-.31-8h8.525V-9.982a1.915,1.915,0,0,0-.14-.868q-.139-.248-.822-.31t-2.325-.062H79.639q-1.488,0-1.488,1.24ZM99.293,0a4.173,4.173,0,0,1-3.224-.992A4.411,4.411,0,0,1,95.2-3.968v-7.254H92.659v-2.666h1.3a1.51,1.51,0,0,0,.853-.186,1.2,1.2,0,0,0,.388-.744l.62-3.317h3.162v4.247h6.448v2.666H98.983v7.285a1.156,1.156,0,0,0,.372,1.023,2.029,2.029,0,0,0,1.116.248h4.371l.31,2.356q-.651.093-1.984.2T100.254,0Zm12.121,0a13.745,13.745,0,0,1-2.945-.217q-.868-.217-.868-.434l.93-2.325q.9.093,3.3.2t5.937.109h1.55q.775,0,.977-.418a2.641,2.641,0,0,0,.2-1.132,2.431,2.431,0,0,0-.232-1.147.972.972,0,0,0-.946-.434h-7.626a4.8,4.8,0,0,1-3.131-.821,3.064,3.064,0,0,1-.961-2.465v-1.24a6.682,6.682,0,0,1,.093-1.023,3.118,3.118,0,0,1,.465-1.178,2.731,2.731,0,0,1,1.209-.976,5.655,5.655,0,0,1,2.325-.388h8.556a11.026,11.026,0,0,1,2.635.217q.775.217.775.434l-.31,2.325q-.9-.093-3.317-.2t-5.921-.108h-1.55q-.775,0-.977.418a2.227,2.227,0,0,0-.2.977,2.105,2.105,0,0,0,.2.976q.2.387.977.387h7.626a4.627,4.627,0,0,1,3.1.868,2.8,2.8,0,0,1,.992,2.2v1.829a9.512,9.512,0,0,1-.078,1.178,2.6,2.6,0,0,1-.45,1.163,2.6,2.6,0,0,1-1.209.884A6.455,6.455,0,0,1,120.187,0ZM131.13,0l-4.991-13.888h4.34l2.511,7.874.806,2.759h.31l.465-2.449,2.139-8.184h4.96L143.933-5.7l.434,2.449h.31l.837-2.821,2.356-7.812h4.34l-.5,1.891L147.25,0h-4.96l-2.573-8.525-.31-1.457h-.31l-.372,1.457L136.09,0Zm26.629,0a4.552,4.552,0,0,1-3.41-1.1,4.189,4.189,0,0,1-1.054-3.023,4.16,4.16,0,0,1,1.1-3.1,4.618,4.618,0,0,1,3.363-1.085h1.581q2.325,0,4.185.124t3.069.248V-9.982a2.78,2.78,0,0,0-.062-.573.734.734,0,0,0-.372-.481,2.174,2.174,0,0,0-1.054-.186h-1.55q-3.379,0-5.642.108t-3.069.2l-.341-2.356q0-.434,2.356-.527t7.874-.093h1.55a5.291,5.291,0,0,1,2.387.434,2.739,2.739,0,0,1,1.194,1.085,3.6,3.6,0,0,1,.434,1.317,10.045,10.045,0,0,1,.077,1.132V0h-2.542l-1.209-.62q-1.3.217-3.131.419a38.615,38.615,0,0,1-4.185.2Zm.806-2.666h7.1a1.464,1.464,0,0,0,.806-.124,1.376,1.376,0,0,0,.124-.775V-5.952h-8.029a1.424,1.424,0,0,0-1.162.4,2.015,2.015,0,0,0-.326,1.271,1.711,1.711,0,0,0,.372,1.24A1.516,1.516,0,0,0,158.565-2.666Zm15.376,8.432V-13.888h2.542l.775.4q1.4-.155,3.333-.279t4.417-.124h1.581a5.646,5.646,0,0,1,2.387.4,2.635,2.635,0,0,1,1.193,1.023,3.348,3.348,0,0,1,.434,1.3,11.066,11.066,0,0,1,.077,1.24v5.952a10.045,10.045,0,0,1-.077,1.132,3.6,3.6,0,0,1-.434,1.317,2.739,2.739,0,0,1-1.193,1.085A5.291,5.291,0,0,1,186.589,0h-1.581q-2.356,0-4.185-.124t-3.1-.248V5.766Zm4.743-8.432h6.727a1.784,1.784,0,0,0,1.038-.31,1.055,1.055,0,0,0,.449-.93V-9.982a1.084,1.084,0,0,0-.326-.961,1.9,1.9,0,0,0-1.162-.279h-1.55q-1.984,0-3.518.078t-2.62.17v7.347a1.411,1.411,0,0,0,.139.821A1.411,1.411,0,0,0,178.684-2.666Z"
				transform="translate(-1.86 19.623)"
				fill="#fff"
			/>
		</svg>
		<br>
		<b>We will be back this evening after the </b> 
		<a
			style="padding-top: 20px; color: #fff; text-decoration: underline;"
			target="_blank"
			href="https://blog.lamden.io/arko-faq-54dc0634de62">Lamden ARKO Update</a
		>
	</div>
	<canvas
		id="canvas"
		style="width: 100%; height: 100%; padding: 0; margin: 0; z-index: 99"
	/>
	<div id="powered">
		<PoweredByLamden />
	</div>
</main>

<style>
	main {
		height: 100%;
		width: 100%;
	}

	h1 {
		color: #ff3e00;
		text-transform: uppercase;
		font-size: 4em;
		font-weight: 100;
	}
	#powered {
		position: absolute;
		bottom: 40px;
		right: 100px;
	}

	@media (max-width: 500px) {
		main {
			max-width: none;
		}

		#powered {
			width: 100%;
			position: relative;
			bottom: 60px;
			right: unset;
			/* bottom: 40px; */
			text-align: center;
			display: flex;
			align-items: center;
			justify-content: center;
		}
	}
</style>
